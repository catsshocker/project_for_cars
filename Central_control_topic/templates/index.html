<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>AGV å¯¦æ™‚ç›£æ§ç³»çµ±</title>
    <style>
        body { font-family: sans-serif; background: #f8f9fa; padding: 20px; }
        table { width: 100%; border-collapse: collapse; background: white; margin-bottom: 20px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        th { background: #333; color: white; }
        .battery-low { color: red; font-weight: bold; }
    </style>
</head>
<body>

    <h2>ğŸš— è»Šè¼›ç‹€æ…‹ (æ¯ç§’æ›´æ–°)</h2>
    <table id="vehicle-table">
        <thead>
            <tr><th>ID</th><th>åº§æ¨™ (X, Y)</th><th>é›»é‡</th><th>ç‹€æ…‹</th></tr>
        </thead>
        <tbody></tbody>
    </table>

    <h2>ğŸ“‹ ä»»å‹™ç‹€æ…‹</h2>
    <table id="task-table">
        <thead>
            <tr><th>è»Šè¼› ID</th><th>ç›®æ¨™</th><th>ç‹€æ…‹</th></tr>
        </thead>
        <tbody></tbody>
    </table>

    <script>
        function updateData() {
            fetch('/api/status')
                .then(response => response.json())
                .then(data => {
                    // 1. æ›´æ–°è»Šè¼›è¡¨æ ¼
                    const vBody = document.querySelector('#vehicle-table tbody');
                    vBody.innerHTML = data.vehicles.map(v => `
                        <tr>
                            <td>${v.id}</td>
                            <td>${v.x.toFixed(1)}, ${v.y.toFixed(1)}</td>
                            <td class="${v.battery < 20 ? 'battery-low' : ''}">${v.battery}%</td>
                            <td>${v.status}</td>
                        </tr>
                    `).join('');

                    // 2. æ›´æ–°ä»»å‹™è¡¨æ ¼
                    const tBody = document.querySelector('#task-table tbody');
                    tBody.innerHTML = data.tasks.map(t => `
                        <tr>
                            <td>${t.vehicle_id}</td>
                            <td>${t.target_x}, ${t.target_y}</td>
                            <td>${t.done === 1 ? 'âœ… å®Œæˆ' : 'â³ åŸ·è¡Œä¸­'}</td>
                        </tr>
                    `).join('');
                });
        }

        // æ¯ 500 æ¯«ç§’ (1ç§’) åŸ·è¡Œä¸€æ¬¡ updateData
        setInterval(updateData, 500);
        
        // åˆå§‹åŸ·è¡Œä¸€æ¬¡
        updateData();
    </script>
</body>
</html>